|> section
    title=Missing Closure Detection Test
    description=Testing immediate error detection for missing code block closures

This file tests that errors are shown immediately when a code block
is missing its closure, rather than waiting until the end of the document.

|> test1
    type=missing-closure-before-tag

Code block without closure, followed by new tag:

```
This code block is missing its closing backticks.
It should show an error on the next tag line.
```

|> new-tag-should-show-error
    error=Expected error about missing closure above

The error should appear immediately on the "|> new-tag-should-show-error" line,
indicating that the code block above is missing its closure.

|> test2
    type=proper-closure

Code block with proper closure (should work fine):

```
This code block has proper closure.
Content goes here.
    ```
    <h1>hello</h1>
    <h1>hello</h1>
    ```
```

|> normal-tag
    status=should-work-normally

This should work without errors since the code block above was properly closed.

|> test3
    type=nested-content-then-missing-closure
```
    <h1>HTML content</h1>
    ```
    print("nested code")
    ```
```

Code block with nested content, but missing final closure:

```
<h1>HTML content</h1>
```python
print("nested code")
```
```
More content that should be in the code block.

|> another-tag-should-error
    error=Should show missing closure error

Again, the error should appear immediately on this tag line, not at end of document.

|> test4
    type=indented-missing-closure

Indented code block missing closure:

    ```
    Indented code block content
    Missing its closure
    ```

|> tag-at-root-level
    error=Should detect missing closure for indented block

The indented code block above should show an error on this tag.

|> test5
    type=multiple-missing-closures

First missing closure:

```
First code block without closure
    ```html
    <h1> hello world </h1>
    ```
```

|> intermediate-tag
    error=Should show error for first block

Second missing closure:

    ```
    Second code block without closure
    ```

|> final-tag
    error=Should show error for second block

    ```javascript
        const code = `template with backticks`;
        ```bash
        echo "nested"
        ```
        console.log('this should still be highlighted as JS');
    ```


Expected behavior:
- Errors should appear immediately when encountering new tags after unclosed code blocks
- Both the opening line and the tag line should show error diagnostics
- No need to wait until end of document to see missing closure errors
- Each missing closure should be detected separately and immediately
